# Architecture Overview

## Overview

NextGen Digital Banking Platform is a full-stack web application that provides banking services including account management, fund transfers, transaction history, customer support, and fraud detection. The application follows a client-server architecture with a clear separation between the frontend and backend.

The application is built using:
- **Frontend**: React with TypeScript, Tailwind CSS, shadcn/ui components
- **Backend**: Node.js with Express.js
- **Database**: PostgreSQL with Drizzle ORM
- **Deployment**: Configured for Replit environment with auto-scaling

## System Architecture

### High-Level Architecture

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │      │                 │
│  React Client   │─────▶│  Express Server │─────▶│   PostgreSQL    │
│                 │◀─────│                 │◀─────│                 │
└─────────────────┘      └─────────────────┘      └─────────────────┘
```

The application follows a three-tier architecture:
1. **Presentation Layer**: React client application with UI components
2. **Application Layer**: Express.js API server handling business logic
3. **Data Layer**: PostgreSQL database managed through Drizzle ORM

### Directory Structure

```
├── client/               # Frontend React application
│   ├── index.html        # Entry HTML file
│   └── src/              # Source code
│       ├── components/   # UI components
│       ├── hooks/        # Custom React hooks
│       ├── lib/          # Utility functions and shared logic
│       └── pages/        # Page components
├── server/               # Backend Express application
│   ├── index.ts          # Server entry point
│   ├── routes.ts         # API route definitions
│   ├── storage.ts        # Data access layer
│   ├── vite.ts           # Vite server setup for development
│   └── operations/       # Business logic modules
├── shared/               # Shared code between client and server
│   └── schema.ts         # Database schema definitions
└── migrations/           # Database migration files (generated by Drizzle)
```

## Key Components

### Frontend

The frontend is built using React with TypeScript and uses several key libraries:

1. **UI Component Library**: Utilizes shadcn/ui, a collection of reusable UI components built on Radix UI primitives. This provides accessible, customizable components with consistent styling.

2. **State Management**: Uses React Query for server state management and React Context for client-side state (like authentication state).

3. **Routing**: Uses Wouter for lightweight client-side routing.

4. **Styling**: Implements Tailwind CSS for utility-first styling with a customized design system.

5. **Form Handling**: Uses React Hook Form with Zod for form validation.

### Backend

The backend is an Express.js application with TypeScript providing RESTful APIs:

1. **API Layer**: Express routes in `server/routes.ts` define the API endpoints.

2. **Business Logic**: Organized in the `server/operations/` directory with separate modules for different domains (accounts, fraud detection, ACH transfers).

3. **Data Access Layer**: Abstracted through the `storage.ts` interface, which provides methods for CRUD operations on all entities.

4. **Session Management**: Uses express-session with a memory store for session handling.

5. **Error Handling**: Centralized error handling middleware to standardize error responses.

### Database

The application uses PostgreSQL with Drizzle ORM for database interactions:

1. **Schema**: Defined in `shared/schema.ts` using Drizzle's schema definition syntax.

2. **Entities**: Key entities include:
   - Users
   - Accounts
   - Account Types
   - Transactions
   - Transfers
   - ACH Transfers
   - Support Tickets
   - Fraud Alerts
   - Products

3. **Validation**: Uses Drizzle-Zod integration to create validation schemas from the database schema.

## Data Flow

### Authentication Flow

1. User submits login credentials via the `/api/auth/login` endpoint
2. Server validates credentials against the stored user data
3. On successful authentication, a session is created and stored
4. Subsequent requests include the session cookie for authentication

### Transaction Flow

1. User initiates a transaction (transfer, withdrawal, deposit)
2. The request is validated using Zod schemas
3. Transaction goes through fraud detection (`detectFraudTransaction`)
4. If approved, the transaction is recorded and account balances are updated
5. Transaction details are returned to the client

### ACH Transfer Flow

1. User initiates an ACH transfer with external account details
2. The system validates the request and creates a pending ACH transfer record
3. The `processACHFile` function handles incoming ACH files
4. Status updates are sent back to the client through API endpoints

## External Dependencies

### Frontend Dependencies

- **@radix-ui/***: UI primitives for building accessible components
- **@tanstack/react-query**: Data fetching and caching library
- **class-variance-authority**: Utility for creating variant components
- **clsx/tailwind-merge**: Utilities for conditional CSS class composition
- **date-fns**: Date manipulation library
- **react-hook-form/zod**: Form handling and validation

### Backend Dependencies

- **express**: Web server framework
- **express-session**: Session management
- **drizzle-orm**: TypeScript ORM for database interaction
- **@neondatabase/serverless**: PostgreSQL connection adapter
- **zod**: Schema validation library

## Deployment Strategy

The application is configured for deployment on Replit with the following setup:

1. **Development Mode**:
   - `npm run dev` command runs the Express server with Vite in development mode
   - Hot module replacement is enabled for the React frontend

2. **Production Build**:
   - Frontend: Vite builds the React application to static files in `dist/public`
   - Backend: esbuild bundles the server code to `dist/index.js`

3. **Deployment Target**:
   - Configured for auto-scaling on Replit
   - Express serves the static frontend files in production

4. **Environment Configuration**:
   - Uses environment variables for configuration (DATABASE_URL, SESSION_SECRET)
   - Different configurations for development and production environments

5. **Database Provisioning**:
   - Database connection details are provided via the DATABASE_URL environment variable
   - Database schema can be updated with `npm run db:push` command

The deployment strategy emphasizes a simple, unified workflow where both frontend and backend are bundled and served from the same server in production.